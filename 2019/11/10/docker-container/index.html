<article id="post-docker-container" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/10/docker-container/" class="article-date">
  <time datetime="2019-11-10T04:41:34.000Z" itemprop="datePublished">2019-11-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      dockerコンテナ
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="dockerコンテナ"><a href="#dockerコンテナ" class="headerlink" title="dockerコンテナ"></a>dockerコンテナ</h2><h3 id="状態-ライフサイクル"><a href="#状態-ライフサイクル" class="headerlink" title="状態/ライフサイクル"></a>状態/ライフサイクル</h3><p>dockerコンテナはイメージと違い、状態を持っている。状態は、<code>実行中・停止・破棄</code>がある。</p>
<h4 id="実行中"><a href="#実行中" class="headerlink" title="実行中"></a>実行中</h4><p><code>docker container run</code>で起動させると実行中となり、Dockerfileに記述された<code>CMD</code>のコマンドを実行し終わるまで自動中となる。<br>よって、デーモン/サーバー系のコマンドであれば任意に停止、もしくは異常終了するまでそのコンテナは実行中となるが、そうでない場合(lsコマンドなど即座に終了するもの)は、そのコマンドを終えるまでが実行中となる。<br>CMDの実行が完了すると、コンテナは<code>停止</code>の状態へ移行する。</p>
<h4 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h4><p><code>実行中</code>であったコンテナが<code>停止</code>した状態。停止した状態なので、再利用が可能。停止した時点の情報を持っているので、ディスクなどの容量は使用している。</p>
<h4 id="破棄"><a href="#破棄" class="headerlink" title="破棄"></a>破棄</h4><p><code>停止</code>状態のコンテナは明示的に<code>破棄</code>をしない限りディスクに残り続ける。頻繁に実行-&gt;停止を繰り返す運用の場合には、停止されたコンテナがたまるため（再利用されない限りは実行のたびに新たなコンテナが立ち上がる）、ディスク容量を圧迫していくことになる。完全に不要となったコンテナは削除を行った方がいい。<br>ただし、一度破棄したコンテナを再び利用することはできないため、退避しなければいけない情報がないか確認してから行うこと。</p>
<h3 id="コンテナ操作"><a href="#コンテナ操作" class="headerlink" title="コンテナ操作"></a>コンテナ操作</h3><p>dockerのコンテナは、dockerイメージから作成を行う。作成が完了されると実行状態となる。<br>イメージの指定方法は、イメージ名かイメージに割り振られたIDを指定することができる。</p>
<p>イメージ名での作成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container run [options] イメージ名[:タグ] [コマンド] [コマンド引数...]</span><br></pre></td></tr></table></figure>

<p>イメージIDでの作成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container run [options] イメージID [コマンド] [コマンド引数...]</span><br></pre></td></tr></table></figure>

<h4 id="名前付きコンテナ"><a href="#名前付きコンテナ" class="headerlink" title="名前付きコンテナ"></a>名前付きコンテナ</h4><p>イメージからコンテナを作成した場合、コンテナの名前は自動で割り振られる。</p>
<p><code>docker container ls [--all]</code>を行った際に<code>NAMES</code>列に記載されているのが自動で割り振られたコンテナの名前。<br>オプション<code>--all</code>を指定することで、停止中のコンテナについている名前も確認することができる。この名前を利用して、再利用することも可能。<br>また、コンテナ起動時にオプションで名前を付けることもできる。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container run --name [任意のコンテナ名] [イメージ名]:[タグ]</span><br></pre></td></tr></table></figure>

<p>イメージの指定の仕方はコンテナの起動の項目を参照。<br>ホスト側のポートは省略することができ、省略時は自動で空いているエフェメラルポートが割り当てられる。<br>割り当てられたポートは<code>docker container ls</code>で表示される<code>ports</code>の項目で確認できる。</p>
<h2 id="実行中コンテナの標準出力を取得"><a href="#実行中コンテナの標準出力を取得" class="headerlink" title="実行中コンテナの標準出力を取得"></a>実行中コンテナの標準出力を取得</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container logs [-f] コンテナID/コンテナ名</span><br></pre></td></tr></table></figure>

<p><code>-f</code>をつけると<code>tail -f</code>のように、指定したコンテナの標準出力を取得し続ける。</p>
<h2 id="実行中コンテナでコマンドの実行"><a href="#実行中コンテナでコマンドの実行" class="headerlink" title="実行中コンテナでコマンドの実行"></a>実行中コンテナでコマンドの実行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container exec [options] コンテナID/コンテナ名 コンテナで実行したいコマンド</span><br></pre></td></tr></table></figure>
<p><code>-i -i / -it sh</code> で実行中のコンテナにシェルで操作ができる。</p>
<h2 id="コンテナとのファイルコピー"><a href="#コンテナとのファイルコピー" class="headerlink" title="コンテナとのファイルコピー"></a>コンテナとのファイルコピー</h2><p>コンテナからホスト</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker contaner cp [options] コンテナID/コンテナ名:コピー元パス コピー先ホストパス</span><br></pre></td></tr></table></figure>

<p>ホストからコンテナ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container cp [option] コピー元ホストパス コンテナID/コンテナ名:コピー先パス</span><br></pre></td></tr></table></figure>

<h2 id="コンテナの破棄"><a href="#コンテナの破棄" class="headerlink" title="コンテナの破棄"></a>コンテナの破棄</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container prune [options]</span><br></pre></td></tr></table></figure>

<p>停止中のコンテナを一括削除できる。</p>
<h3 id="イメージの削除"><a href="#イメージの削除" class="headerlink" title="イメージの削除"></a>イメージの削除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune [options]</span><br></pre></td></tr></table></figure>

<p>不要そうなdockerイメージをdockerが判断して削除してくれる。</p>
<h3 id="いろいろ削除"><a href="#いろいろ削除" class="headerlink" title="いろいろ削除"></a>いろいろ削除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune</span><br></pre></td></tr></table></figure>

<p>停止中のコンテナ、ネットワーク、イメージ、ビルドキャッシュといった内容の削除をしてくれる。</p>
<h2 id="コンテナの統計情報を取得"><a href="#コンテナの統計情報を取得" class="headerlink" title="コンテナの統計情報を取得"></a>コンテナの統計情報を取得</h2><pre><code>docker container stats [options] コンテナ名/コンテナID[ ...(複数指定可)]</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://asobitagari.github.io/2019/11/10/docker-container/" data-id="cki5otti60009d0vw354rhzqp" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/container/" rel="tag">container</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/development/" rel="tag">development</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/18/load-test/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">次の記事</strong>
      <div class="article-nav-title">
        
          負荷テストツール
        
      </div>
    </a>
  
  
    <a href="/2019/11/05/docker-memo/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前の記事</strong>
      <div class="article-nav-title">Docker メモ</div>
    </a>
  
</nav>

  
</article>

