<article id="post-docker-memo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/05/docker-memo/" class="article-date">
  <time datetime="2019-11-05T09:31:19.000Z" itemprop="datePublished">2019-11-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Docker メモ
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><h3 id="インストラクション"><a href="#インストラクション" class="headerlink" title="インストラクション"></a>インストラクション</h3><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>　FROMは作成するDockerイメージのベースとなるイメージを指定でいる。<br>　FROMで指定できるDockerイメージはDocker Hubに公開されているものから指定できる。</p>
<h4 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h4><p>　イメージ作者の情報などを記述。</p>
<h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><p>　Dockerコンテナ内で使える環境変数を設定できる。</p>
<h3 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h3><p>　ビルド時に指定する引数から値を受け取ることができる。<br>　Dockerfile内で指定したARGの引数と、ビルド時に指定する引数はそろえる必要がある。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#コマンド：sampleargがそろえるべき名前</span><br><span class="line">&gt; docker image build --build-arg samplearg=okok -t example/dockerimage .</span><br><span class="line"></span><br><span class="line">#Dockerfileでは以下のように名前を指定して二行目のように値を取り出すことができる。</span><br><span class="line">ARG samplearg</span><br><span class="line">ENV BUILD_ARG=$&#123;samplearg&#125;</span><br></pre></td></tr></table></figure>



<h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p>　RUNはDockerイメージビルド時に、Dockerコンテナ内で実行するコマンドを定義する。<br>　RUNの引数には実行したいコマンドをそのまま記述する。</p>
<h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>　COPYはDockerを動作させているホストマシン上のファイルやディレクトリをDockerコンテナ内にコピーするためのインストラクション。</p>
<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>　CMDはDockerコンテナとして実行する際に、コンテナ内で実行するプロセスを指定する。<br>　RUNはイメージをビルドするために使い、CMDはコンテナ起動時に一度実行される。</p>
<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>　ENTRYPOINTにはコマンドを記述する。CMDはENTRYPOINTへの引数となる。–entrypointでrun時に指定することで上書きできる。</p>
<h2 id="ビルド"><a href="#ビルド" class="headerlink" title="ビルド"></a>ビルド</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image build -t イメージ[:タグ名] Dockerfileまでのパス</span><br></pre></td></tr></table></figure>

<p>タグ名は省略するとlatestとなる。</p>
<h2 id="イメージからコンテナの実行"><a href="#イメージからコンテナの実行" class="headerlink" title="イメージからコンテナの実行"></a>イメージからコンテナの実行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker [container] run [-d] [-i] [-t] [-rm] [-v ホスト側ディレクトリ:コンテナ側ディレクトリ] イメージ名[/追加のパス]:タグ名</span><br></pre></td></tr></table></figure>

<p><code>-d</code>オプションをつけないとフォアグランドで実行されてしまう。-dをつけて起動した場合はコンテナIDが標準出力に出力される。<br>containerは省略可能だが、最近の風潮ではタイプが長くなるがつけて記述するほうが好まれるらしい。</p>
<p><code>-i</code>起動後にコンテナの標準入力との結びつきを維持する。</p>
<p><code>-t</code>疑似端末を有効にする。大抵の場合<code>-i</code>と同時に用いられ、同時指定の<code>-it</code>が省略形として存在する。コンテナ起動後に、疑似端末が有効となり標準入力からコマンドを実行できるようになる。</p>
<p><code>-rm</code>コンテナの終了時にコンテナを破棄する。</p>
<p><code>-v</code>ホストとコンテナ間でディレクトリやファイルの共有を行う。</p>
<h3 id="そのほかオプション"><a href="#そのほかオプション" class="headerlink" title="そのほかオプション"></a>そのほかオプション</h3><p><code>-f</code> Dockerfileのファイル名を指定できる。省略時は<code>Dockerfile</code></p>
<p><code>--pull=true</code> ビルド時に<code>FROM</code>で指定したイメージをレジストリからダウンロードを必ず行う。省略時は、すでにダウンロード済みであれば、ホスト内のキャッシュからビルドを行い、存在しない場合はレジストリからダウンロードする。</p>
<h2 id="起動中のコンテナの確認"><a href="#起動中のコンテナの確認" class="headerlink" title="起動中のコンテナの確認"></a>起動中のコンテナの確認</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker container ls</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p>上記二つはどちらも同じ動作。<br>表示項目のフィルタリングもできる。コンテナIDだけ抽出する場合は以下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container ls --filter &quot;ancestor=[イメージ名]&quot; [-q]</span><br></pre></td></tr></table></figure>
<p>-q でコンテナIDのみの抽出</p>
<h2 id="起動中のコンテナの停止"><a href="#起動中のコンテナの停止" class="headerlink" title="起動中のコンテナの停止"></a>起動中のコンテナの停止</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container stop コンテナID/コンテナ名</span><br></pre></td></tr></table></figure>

<p><code>docker container ls</code>と組み合わせることができる。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container stop $(docker container ls --filter &quot;ancestor=[イメージ名&quot; -q])</span><br></pre></td></tr></table></figure>

<h2 id="停止中のコンテナの再起動"><a href="#停止中のコンテナの再起動" class="headerlink" title="停止中のコンテナの再起動"></a>停止中のコンテナの再起動</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container restart コンテナID/コンテナ名</span><br></pre></td></tr></table></figure>

<h2 id="停止中のコンテナの破棄"><a href="#停止中のコンテナの破棄" class="headerlink" title="停止中のコンテナの破棄"></a>停止中のコンテナの破棄</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container rm [-f] コンテナID/コンテナ名</span><br></pre></td></tr></table></figure>

<p><code>-f</code>オプションで実行中のコンテナの削除も可能。</p>
<h2 id="dockerイメージの検索"><a href="#dockerイメージの検索" class="headerlink" title="dockerイメージの検索"></a>dockerイメージの検索</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search [options] 検索キーワード</span><br></pre></td></tr></table></figure>

<p><code>-f, --filter filter</code> 出力をフィルターする。<br><code>--format 文字列</code> 出力をフォーマットする。<br><code>--limit 数値</code> 表示件数を指定の数値に制限する。<br><code>--no-trunc</code> 出力を省略せずに表示する。</p>
<h2 id="dockerイメージの取得"><a href="#dockerイメージの取得" class="headerlink" title="dockerイメージの取得"></a>dockerイメージの取得</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull [options] リポジトリ名[:タグ名]</span><br></pre></td></tr></table></figure>

<p>例によってタグ名を省略した場合は<code>latest</code>が指定される。</p>
<h2 id="ホスト内のイメージの一覧を取得"><a href="#ホスト内のイメージの一覧を取得" class="headerlink" title="ホスト内のイメージの一覧を取得"></a>ホスト内のイメージの一覧を取得</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image ls [options] [リポジトリ[:タグ名]]</span><br></pre></td></tr></table></figure>

<p>ダウンロード済み、ビルド済みのイメージの一覧を表示する。</p>
<h2 id="dockerイメージのタグ付け"><a href="#dockerイメージのタグ付け" class="headerlink" title="dockerイメージのタグ付け"></a>dockerイメージのタグ付け</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image tag 元のイメージ名[:タグ名] 新しいイメージ名[:タグ名]</span><br></pre></td></tr></table></figure>

<p>タグ名を省略時は<code>latest</code></p>
<h2 id="docker-Hub-へログイン"><a href="#docker-Hub-へログイン" class="headerlink" title="docker Hub へログイン"></a>docker Hub へログイン</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login [-u id] [-p パスワード]</span><br></pre></td></tr></table></figure>

<p>オプションを省略した場合は対話式に進めることができる。ID&amp;PASSを入力して認証する。</p>
<h2 id="docker-hub-イメージの登録"><a href="#docker-hub-イメージの登録" class="headerlink" title="docker hub イメージの登録"></a>docker hub イメージの登録</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image push [options] リポジトリ名[:タグ名]</span><br></pre></td></tr></table></figure>

<p>ログイン済みであれば、自分のリポジトリにイメージを登録することができる。</p>
<h2 id="ポートフォワーディング"><a href="#ポートフォワーディング" class="headerlink" title="ポートフォワーディング"></a>ポートフォワーディング</h2><p>ポートフォワーディングは<code>docker container run</code>の起動コマンド時に<code>-p</code>オプションで指定できる。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container run -d -p [ホストポート]:コンテナポート イメージの指定</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://asobitagari.github.io/2019/11/05/docker-memo/" data-id="cki5otti7000ad0vwhok28p9l" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/container/" rel="tag">container</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/development/" rel="tag">development</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/10/docker-container/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">次の記事</strong>
      <div class="article-nav-title">
        
          dockerコンテナ
        
      </div>
    </a>
  
  
</nav>

  
</article>

